{"title":"Github Actions自动化部署实践Hexo博客","date":"2021-07-08T21:15:32.971Z","date_formatted":{"ll":"2021年7月8日","L":"2021/07/08","MM-DD":"07-08"},"author":"feilang235","link":"20210708hexoblog","tags":["Github Action","hexo","inside主题","博客"],"categories":["技术分享"],"updated":"2021-07-20T12:32:19.136Z","content":"<h3 id=\"什么是github-actions？\">什么是Github Actions？<a title=\"#什么是github-actions？\" href=\"#什么是github-actions？\"></a></h3>\n<p><img src=\"http://blog.feilang235.com/16258011457872r7z91to.png\" alt=\"paste image\" loading=\"lazy\" class=\"φbp\"></p>\n<span id=\"more\"></span>\n<p>直接点击传送门，看看阮一峰大佬的<a href=\"http://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html\" target=\"_blank\">Github Actions</a> 入门教程;</p>\n<h4 id=\"创建-github-仓库。\">创建 github 仓库。<a title=\"#创建-github-仓库。\" href=\"#创建-github-仓库。\"></a></h4>\n<p>在 github 下创建两个仓库。一个是 hexo-blog 设为私密。一个是 <a href=\"https://github.com/feilang235/feilang235.github.io\" target=\"_blank\">feilang235.github.io</a> 公开。<br>\n克隆仓库 hexo-blog 。</p>\n<p>初始化博客</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https://github.com/feilang235/hexo-blog.git</span><br><span class=\"line\">cd hexo-blog</span><br><span class=\"line\">mkdir test</span><br><span class=\"line\">cd test </span><br><span class=\"line\">hexo init</span><br><span class=\"line\">cd ../</span><br><span class=\"line\">mv test/* ./</span><br><span class=\"line\">rm -rf test/</span><br></pre></td></tr></table></figure>\n<p>为什么要先创建一个 test 文件夹呢？<br>\n因为 hexo init 必须要在一个空文件夹初始化。</p>\n<p>测试</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo g # 生成代码 </span><br><span class=\"line\">Hexo s # 启动本地服务</span><br></pre></td></tr></table></figure>\n<p><img src=\"http://blog.feilang235.com/1625801246294qohmttr5.png\" alt=\"paste image\" loading=\"lazy\"><br>\n出现这样后，就启动成功了，打开 <a href=\"http://localhost:4000\">http://localhost:4000</a> 即可访问本地仓库。使用的是hexo 默认的主题。</p>\n<h3 id=\"添加-github-action-部署\">添加 github action 部署<a title=\"#添加-github-action-部署\" href=\"#添加-github-action-部署\"></a></h3>\n<p>生成公钥和私钥并上传</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa -C &#x27;your email&#x27;</span><br></pre></td></tr></table></figure>\n<p>然后一路回车到底。<br>\n会生成两个文件。一个文件是xxx.pub是公钥，xxx是私钥与之对应。<br>\n绑定公钥与私钥，公钥—–&gt;<a href=\"http://xxx.github.io\">xxx.github.io</a>，私钥—–&gt;hexo-blog；<br>\n下图应该详细阐述了怎么绑定公钥与私钥~<br>\n<img src=\"http://blog.feilang235.com/162580127699413v90bj5.png\" alt=\"paste image\" loading=\"lazy\"><br>\n注意这里需要输入一个 名称。在下面的脚本中会用到。需要对应。建议输入：HEXO_DEPLOY_KEY</p>\n<p>增加 github 部署脚本<br>\n在 hexo-blog 路径下创建文件： ./github/workflows/blog.yml<br>\n编辑 blog.yml 文件输入内容如下：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">name:</span> <span class=\"string\">Deploy</span> <span class=\"string\">Blog</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">on:</span> [<span class=\"string\">push</span>] <span class=\"comment\"># 当有新push时运行</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">jobs:</span></span><br><span class=\"line\">  <span class=\"attr\">build-and-deploy:</span> <span class=\"comment\"># 创建job</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">runs-on:</span> <span class=\"string\">ubuntu-latest</span> <span class=\"comment\"># 在最新版的Ubuntu系统下运行</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">steps:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Checkout</span> <span class=\"comment\"># 将仓库内master分支的内容下载到工作目录</span></span><br><span class=\"line\">      <span class=\"attr\">uses:</span> <span class=\"string\">actions/checkout@v1</span> <span class=\"comment\"># 脚本来自 https://github.com/actions/checkout</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Setup</span> <span class=\"string\">Node.js</span></span><br><span class=\"line\">      <span class=\"attr\">uses:</span> <span class=\"string\">actions/setup-node@v1</span></span><br><span class=\"line\">      <span class=\"attr\">with:</span></span><br><span class=\"line\">        <span class=\"attr\">node-version:</span> <span class=\"string\">&#x27;12&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Setup</span> <span class=\"string\">Hexo</span> <span class=\"string\">Env</span></span><br><span class=\"line\">      <span class=\"attr\">env:</span></span><br><span class=\"line\">        <span class=\"attr\">ACTION_DEPLOY_KEY:</span> <span class=\"string\">$&#123;&#123;</span> <span class=\"string\">secrets.HEXO_DEPLOY_KEY</span> <span class=\"string\">&#125;&#125;</span> <span class=\"comment\"># 拿到仓库配置的私钥：HEXO_DEPLOY_KEY</span></span><br><span class=\"line\">      <span class=\"attr\">run:</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">        # set up private key for push code</span></span><br><span class=\"line\"><span class=\"string\">        mkdir -p ~/.ssh/</span></span><br><span class=\"line\"><span class=\"string\">        echo &quot;$ACTION_DEPLOY_KEY&quot; &gt; ~/.ssh/id_rsa # 配置秘钥</span></span><br><span class=\"line\"><span class=\"string\">        chmod 700 ~/.ssh</span></span><br><span class=\"line\"><span class=\"string\">        chmod 600 ~/.ssh/id_rsa</span></span><br><span class=\"line\"><span class=\"string\">        ssh-keyscan github.com &gt;&gt; ~/.ssh/known_hosts</span></span><br><span class=\"line\"><span class=\"string\">        # set git config</span></span><br><span class=\"line\"><span class=\"string\">        git config --global user.name &quot;feilang235&quot;</span></span><br><span class=\"line\"><span class=\"string\">        git config --global user.email &quot;feilang235@gmail.com&quot;</span></span><br><span class=\"line\"><span class=\"string\">        # install dependencies</span></span><br><span class=\"line\"><span class=\"string\">        npm i -g hexo-cli # 安装hexo</span></span><br><span class=\"line\"><span class=\"string\">        npm i</span></span><br><span class=\"line\"><span class=\"string\">        npm install hexo-deployer-git --save  # 安装git配置</span></span><br><span class=\"line\"><span class=\"string\">        npm install hexo-theme-inside --save  # 安装inside主题</span></span><br><span class=\"line\"><span class=\"string\"></span>    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Hexo</span> <span class=\"string\">Deploy</span></span><br><span class=\"line\">      <span class=\"attr\">run:</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">        # deploy and automatic push code</span></span><br><span class=\"line\"><span class=\"string\">        hexo generate &amp;&amp; hexo deploy # 执行部署程序</span></span><br></pre></td></tr></table></figure>\n<p><font color='red'> 特别注意 </font></p>\n<p>需要将 _config.yml 配置文件中的部署设置为以下信息</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">deploy:</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">git</span></span><br><span class=\"line\">  <span class=\"attr\">repo:</span> <span class=\"string\">git@github.com:feilang235/feilang235.github.io.git</span> <span class=\"comment\"># 这里不能是https的方式</span></span><br><span class=\"line\">  <span class=\"attr\">branch:</span> <span class=\"string\">master</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">feilang235</span></span><br><span class=\"line\">  <span class=\"attr\">email:</span> <span class=\"string\">feilang235@gmail.com</span></span><br></pre></td></tr></table></figure>\n<p>到此为止简单的部署就差不多了</p>\n<h3 id=\"hexo-常用命令\">Hexo 常用命令<a title=\"#hexo-常用命令\" href=\"#hexo-常用命令\"></a></h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo n &#x27;hexo-blog&#x27; # 创建文章，链接为 hexo-blog</span><br><span class=\"line\"></span><br><span class=\"line\">hexo g # 生成代码</span><br><span class=\"line\"></span><br><span class=\"line\">hexo s # 启动本地服务</span><br><span class=\"line\"></span><br><span class=\"line\">hexo d # 部署服务</span><br><span class=\"line\"></span><br><span class=\"line\">hexo clean # 清理生成的文件</span><br></pre></td></tr></table></figure>\n<h3 id=\"设置域名\">设置域名<a title=\"#设置域名\" href=\"#设置域名\"></a></h3>\n<p>在 hexo-blog/source/ 下创建 CNAME 文件。<br>\n在 CNAME 文件中输入你想设置的域名例如：feilang235</p>\n<p>在 域名服务商那里配置域名解析。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">记录类型 主机记录 记录值</span><br><span class=\"line\">CNAME www feilang235.github.io</span><br><span class=\"line\">A @ 192.30.252.153</span><br><span class=\"line\">A @ 192.30.252.154</span><br></pre></td></tr></table></figure>\n<p>重新部署后就可以通过域名访问了。</p>\n<h3 id=\"配置主题\">配置主题<a title=\"#配置主题\" href=\"#配置主题\"></a></h3>\n<p>inside github 地址：<a href=\"https://github.com/ikeq/hexo-theme-inside\">https://github.com/ikeq/hexo-theme-inside</a><br>\n在 部署的 blog.yml 脚本中加上<br>\n<img src=\"http://blog.feilang235.com/1625801423828e7d9uu8u.png\" alt=\"paste image\" loading=\"lazy\"><br>\n修改 _config.yml 的 theme 为 inside 。默认的为 landscape。<br>\n主题内容修改：</p>\n<ol>\n<li>Locate to project/ and run<br>\nnpm install hexo-theme-inside</li>\n<li>Config project/_config.yml<br>\ntheme: inside</li>\n<li>Copy _config.yml to project/_config.inside.yml, see here for full documentation.</li>\n</ol>\n<p>然后修改 _config.inside.yml 内容就行。<br>\n详细配置参考：<a href=\"https://blog.oniuo.com/theme-inside\">https://blog.oniuo.com/theme-inside</a></p>\n<h3 id=\"插件配置\">插件配置<a title=\"#插件配置\" href=\"#插件配置\"></a></h3>\n<p>插件集合地址：<a href=\"https://hexo.io/plugins/\">https://hexo.io/plugins/</a></p>\n<h3 id=\"参考文章\">参考文章<a title=\"#参考文章\" href=\"#参考文章\"></a></h3>\n<p><a href=\"https://www.bigdreamer.cc/article/github-ci/\">https://www.bigdreamer.cc/article/github-ci/</a></p>\n<p><a href=\"http://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html\">http://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html</a></p>\n<p>SEO参考链接：</p>\n<p><a href=\"https://blog.csdn.net/lzy98/article/details/81140704\">https://blog.csdn.net/lzy98/article/details/81140704</a></p>\n","prev":{"title":"逆向微信小红书小程序并获得x-sign算法","link":"20210708-xiaohongshu"},"plink":"http://feilang235.com/20210708hexoblog/","toc":[{"id":"什么是github-actions？","title":"什么是Github Actions？","index":"1"},{"id":"添加-github-action-部署","title":"添加 github action 部署","index":"2"},{"id":"hexo-常用命令","title":"Hexo 常用命令","index":"3"},{"id":"设置域名","title":"设置域名","index":"4"},{"id":"配置主题","title":"配置主题","index":"5"},{"id":"插件配置","title":"插件配置","index":"6"},{"id":"参考文章","title":"参考文章","index":"7"}],"copyright":{"author":"feilang235","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\\\"https://creativecommons.org/licenses/by-nc-sa/4.0/\\\" rel=\\\"external nofollow\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)","published":"2021年7月8日"},"reading_time":"978 字约 7 分钟"}