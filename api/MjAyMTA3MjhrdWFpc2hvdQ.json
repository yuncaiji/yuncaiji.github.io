{"title":"快手 sig 加密算法分析爬虫接口","date":"2021-07-28T19:47:37.000Z","date_formatted":{"ll":"2021年7月28日","L":"2021/07/28","MM-DD":"07-28"},"link":"20210728kuaishou","tags":["si g","快手","快手爬虫","逆向爬虫"],"updated":"2021-07-28T11:51:41.896Z","content":"<p>快手版本 6.8 以后不能直接使用 charles 抓到包了，需要走 vpn 的模式，其实和大众点评一样。</p>\n<p>IOS 设备推荐 使用 Shadowrocket 备注：只能国外才能下载到。</p>\n<p>android 推荐使用：Drony。</p>\n<p>使用方式可以参考：</p>\n<p><a href=\"https://link.zhihu.com/?target=https%3A//www.cnblogs.com/lulianqi/p/11380794.html\" target=\"_blank\">部分APP无法代理抓包的原因及解决方法（flutter 抓包）</a></p>\n<p>就可以解决大部分抓包问题，美团app 除外。</p>\n<span id=\"more\"></span>\n<h2 id=\"签名算法破解\">签名算法破解<a title=\"#签名算法破解\" href=\"#签名算法破解\"></a></h2>\n<p>这里先给一个大致思路，有序有时间了再详细说下。</p>\n<ul>\n<li>\n<p>第一步计算 sig</p>\n</li>\n<li>\n<ul>\n<li>将所有的请求参数进行排序</li>\n<li>使用=号串联所有的数据。拼接成字符串</li>\n<li>加上一个固定的salt 拼接到字符串后面</li>\n<li>对上面得到的数据进行 md5</li>\n</ul>\n</li>\n<li>\n<p>第二步计算**__NStokensig**</p>\n</li>\n<li>\n<ul>\n<li>这里需要用到一个api_client_salt 字段，每个用户都不一样</li>\n<li>将 sig 和 api_client_salt 字段拼接成一个字符串</li>\n<li>然后使用 SHA256 对字符串加密</li>\n<li>再将上面得到的数据进行移位（这一步比较复杂</li>\n</ul>\n</li>\n</ul>\n<p>最终得到 sig 和 _NStokensig 这两个加密字段。就可以请求到数据了。</p>\n<h2 id=\"测试结果\">测试结果<a title=\"#测试结果\" href=\"#测试结果\"></a></h2>\n<p>快手用户接口</p>\n<p><img src=\"http://blog.feilang235.com/v2-29e6bfef03eea5d5df943c322aeff0f5_1440w.jpg\" alt=\"img\" loading=\"lazy\" class=\"φbp\"></p>\n<p>快手用户视频列表</p>\n<p><img src=\"http://blog.feilang235.com/v2-622c3ea91942ac5d253372a0dba18612_1440w.jpg\" alt=\"img\" loading=\"lazy\" class=\"φbp\"></p>\n<p>快手视频评论</p>\n<p><img src=\"http://blog.feilang235.com/v2-7c4a4a89de1778bd730ed84c383b4274_1440w.jpg\" alt=\"img\" loading=\"lazy\" class=\"φbp\"></p>\n<p>以上就是快手的分析哈。</p>\n","prev":{"title":"小红书爬虫接口api对接","link":"20220304xhsapi"},"next":{"title":"逆向美团APP探索mtgsig加密算法","link":"20210720meituan"},"plink":"http://feilang235.com/20210728kuaishou/","toc":[{"id":"签名算法破解","title":"签名算法破解","index":"1"},{"id":"测试结果","title":"测试结果","index":"2"}],"copyright":{"author":"feilang235","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\\\"https://creativecommons.org/licenses/by-nc-sa/4.0/\\\" rel=\\\"external nofollow\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)","published":"2021年7月28日"},"reading_time":"344 字约 2 分钟"}